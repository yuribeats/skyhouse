<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKYHOUSE â€” ADMIN</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: Arial, Helvetica, sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            background: rgba(48, 92, 222, 0.9);
            color: #fff;
            min-height: 100vh;
            padding: 40px 20px;
        }

        h1 {
            font-size: 32px;
            letter-spacing: 4px;
            margin-bottom: 40px;
        }

        h2 {
            font-size: 14px;
            letter-spacing: 3px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .section {
            margin-bottom: 60px;
        }

        .entry {
            border: 1px solid rgba(255,255,255,0.15);
            padding: 20px;
            margin-bottom: 12px;
        }

        .entry-time {
            font-size: 9px;
            letter-spacing: 2px;
            color: rgba(255,255,255,0.3);
            margin-bottom: 14px;
        }

        .entry-q {
            font-size: 11px;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 4px;
        }

        .entry-a {
            font-size: 13px;
            letter-spacing: 1px;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .entry-scale {
            display: inline-block;
            background: #fff;
            color: #000;
            padding: 2px 8px;
            font-size: 11px;
            margin-right: 8px;
        }

        .email-item {
            padding: 12px 16px;
            border: 1px solid rgba(255,255,255,0.15);
            margin-bottom: 8px;
            font-size: 13px;
            letter-spacing: 1px;
        }

        .empty {
            font-size: 12px;
            letter-spacing: 2px;
            color: rgba(255,255,255,0.3);
            padding: 40px 0;
            text-align: center;
        }

        .loading {
            font-size: 12px;
            letter-spacing: 2px;
            color: rgba(255,255,255,0.3);
        }

        .count {
            font-size: 11px;
            letter-spacing: 2px;
            color: rgba(255,255,255,0.4);
            margin-bottom: 20px;
        }

        .clear-btn {
            font-family: Arial, Helvetica, sans-serif;
            font-weight: 700;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            background: transparent;
            color: rgba(255,255,255,0.3);
            border: 1px solid rgba(255,255,255,0.15);
            padding: 6px 14px;
            cursor: pointer;
            margin-left: 16px;
            vertical-align: middle;
        }

        .clear-btn:hover {
            color: #fff;
            border-color: #fff;
        }
    </style>
</head>
<body>
    <h1>SKYHOUSE ADMIN</h1>

    <div class="section">
        <h2>FEEDBACK RESPONSES <button class="clear-btn" onclick="clearFeedback()">CLEAR RESPONSES</button></h2>
        <div class="count" id="feedbackCount"></div>
        <div id="feedbackList"><span class="loading">LOADING...</span></div>
    </div>

    <div class="section">
        <h2>EMAILS</h2>
        <div class="count" id="emailCount"></div>
        <div id="emailList"><span class="loading">LOADING...</span></div>
    </div>

    <script>
        var QUESTIONS = {
            q1: "HOW IMPACTFUL WAS THIS WEEK'S SERVICE?",
            q2: "HOW DID YOU FEEL LEAVING THE SERVICE?",
            q3: "HOW COHESIVE DID THE PACING + FLOW FEEL?",
            q4: "IF YOU COULD REQUEST ONE THING FOR WEEK 3, WHAT WOULD IT BE?",
            q5: "DESCRIBE THE ASCENSION SERVICE TO A FRIEND"
        };

        function esc(s) {
            var d = document.createElement('div');
            d.textContent = s || '';
            return d.innerHTML;
        }

        function formatDate(ts) {
            if (!ts) return '';
            var d = new Date(ts);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' }).toUpperCase();
        }

        function clearFeedback() {
            if (!confirm('CLEAR ALL FEEDBACK RESPONSES?')) return;
            fetch('/api/feedback', { method: 'DELETE' }).then(function(r) { return r.json(); }).then(function() {
                document.getElementById('feedbackList').innerHTML = '<div class="empty">NO FEEDBACK YET</div>';
                document.getElementById('feedbackCount').textContent = '0 RESPONSES';
            });
        }

        fetch('/api/feedback').then(function(r) { return r.json(); }).then(function(data) {
            var list = data.feedback || [];
            var el = document.getElementById('feedbackList');
            document.getElementById('feedbackCount').textContent = list.length + ' RESPONSES';

            if (list.length === 0) {
                el.innerHTML = '<div class="empty">NO FEEDBACK YET</div>';
                return;
            }

            el.innerHTML = list.map(function(entry) {
                var html = '<div class="entry">';
                html += '<div class="entry-time">' + formatDate(entry.timestamp) + '</div>';

                for (var i = 1; i <= 5; i++) {
                    var key = 'q' + i;
                    var scaleKey = key + '_scale';
                    var commentKey = key + '_comment';
                    var answer = entry[key] || entry[commentKey] || '';
                    var scale = entry[scaleKey] || (typeof entry[key] === 'number' ? entry[key] : null);
                    var comment = entry[commentKey] || (typeof entry[key] === 'string' ? entry[key] : '');

                    if (scale || comment) {
                        html += '<div class="entry-q">' + esc(QUESTIONS[key] || key) + '</div>';
                        html += '<div class="entry-a">';
                        if (scale) html += '<span class="entry-scale">' + scale + '/5</span>';
                        if (comment) html += esc(comment);
                        html += '</div>';
                    }
                }

                html += '</div>';
                return html;
            }).join('');
        });

        fetch('/api/emails').then(function(r) { return r.json(); }).then(function(data) {
            var list = data.emails || [];
            var el = document.getElementById('emailList');
            document.getElementById('emailCount').textContent = list.length + ' EMAILS';

            if (list.length === 0) {
                el.innerHTML = '<div class="empty">NO EMAILS YET</div>';
                return;
            }

            el.innerHTML = list.map(function(email) {
                return '<div class="email-item">' + esc(email) + '</div>';
            }).join('');
        });
    </script>
</body>
</html>
